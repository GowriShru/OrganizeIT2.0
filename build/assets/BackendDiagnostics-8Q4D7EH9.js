import{r as u,j as s,C as k,b as T,c as A,h as D,d as E,A as j,w as g,f,p as N,a as v,l as R,X as B,B as w,k as S}from"./index-DtNahLzf.js";import{L as C,C as F}from"./loader-circle-C-Fop8UA.js";function L(){const[d,m]=u.useState(!1),[i,h]=u.useState([]),x=`https://${N}.supabase.co/functions/v1/make-server-efc8e70a`,r=[{name:"Health Check",endpoint:"/health"},{name:"Metrics Dashboard",endpoint:"/metrics/dashboard"},{name:"Projects List",endpoint:"/projects"},{name:"Alerts",endpoint:"/alerts/current"},{name:"Notifications",endpoint:"/notifications"},{name:"Services Health",endpoint:"/services/health"},{name:"FinOps Costs",endpoint:"/finops/costs"},{name:"ESG Carbon",endpoint:"/esg/carbon"}],b=async()=>{m(!0);const e=r.map(t=>({...t,status:"pending"}));h(e);for(let t=0;t<r.length;t++){const o=r[t];try{const a=new AbortController,y=setTimeout(()=>a.abort(),5e3),n=await fetch(`${x}${o.endpoint}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${v}`},signal:a.signal});if(clearTimeout(y),n.ok){const l=await n.json();e[t]={...o,status:"success",message:`Success (${n.status})`,details:l}}else{const l=await n.text();e[t]={...o,status:"error",message:`Error ${n.status}: ${n.statusText}`,details:l}}}catch(a){e[t]={...o,status:"error",message:a instanceof Error?a.message:"Unknown error",details:a}}h([...e])}m(!1)},p=i.filter(e=>e.status==="success").length,c=i.filter(e=>e.status==="error").length;return s.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:s.jsxs(k,{children:[s.jsxs(T,{children:[s.jsx(A,{children:"Backend Diagnostics"}),s.jsx(D,{children:"Test connectivity to Supabase Edge Functions"})]}),s.jsxs(E,{className:"space-y-4",children:[s.jsxs(j,{children:[s.jsx(g,{className:"h-4 w-4"}),s.jsx(f,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{children:[s.jsx("strong",{children:"Project ID:"})," ",N]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Backend URL:"})," ",x]}),s.jsxs("div",{children:[s.jsx("strong",{children:"Auth Key:"})," ",v.substring(0,20),"..."]})]})})]}),s.jsx(R,{onClick:b,disabled:d,className:"w-full",children:d?s.jsxs(s.Fragment,{children:[s.jsx(C,{className:"w-4 h-4 mr-2 animate-spin"}),"Running Tests..."]}):s.jsxs(s.Fragment,{children:[s.jsx(B,{className:"w-4 h-4 mr-2"}),"Run Diagnostics"]})}),i.length>0&&s.jsxs("div",{className:"space-y-2",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsxs(w,{variant:p===r.length?"default":c>0?"destructive":"secondary",children:[p," / ",r.length," Passed"]}),c>0&&s.jsxs(w,{variant:"destructive",children:[c," Failed"]})]}),s.jsx("div",{className:"space-y-2",children:i.map((e,t)=>s.jsxs("div",{className:"flex items-start gap-3 p-3 border rounded-lg",children:[e.status==="pending"&&s.jsx(C,{className:"w-5 h-5 mt-0.5 text-muted-foreground animate-spin"}),e.status==="success"&&s.jsx(S,{className:"w-5 h-5 mt-0.5 text-green-600"}),e.status==="error"&&s.jsx(F,{className:"w-5 h-5 mt-0.5 text-red-600"}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("span",{className:"font-medium",children:e.name}),s.jsx("code",{className:"text-xs text-muted-foreground",children:e.endpoint})]}),e.message&&s.jsx("div",{className:"text-sm text-muted-foreground mt-1",children:e.message}),e.status==="error"&&e.details&&s.jsxs("details",{className:"mt-2",children:[s.jsx("summary",{className:"text-xs cursor-pointer text-muted-foreground",children:"View Details"}),s.jsx("pre",{className:"text-xs mt-2 p-2 bg-muted rounded overflow-x-auto",children:typeof e.details=="string"?e.details:JSON.stringify(e.details,null,2)})]})]})]},t))})]}),c>0&&!d&&s.jsxs(j,{variant:"destructive",children:[s.jsx(g,{className:"h-4 w-4"}),s.jsx(f,{children:s.jsxs("div",{className:"space-y-2",children:[s.jsx("p",{className:"font-medium",children:"Connection Issues Detected"}),s.jsx("p",{className:"text-sm",children:"The Supabase Edge Function may not be deployed or accessible. This is expected in Figma Make preview mode."}),s.jsxs("p",{className:"text-sm",children:[s.jsx("strong",{children:"Note:"})," The backend will work once the app is published or when the Edge Function is properly deployed."]})]})})]})]})]})})}export{L as BackendDiagnostics};
